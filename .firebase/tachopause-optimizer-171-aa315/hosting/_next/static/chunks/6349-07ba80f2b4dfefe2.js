"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6349],{6349:function(e,t,o){o.d(t,{Ho:function(){return g},T3:function(){return m},aC:function(){return p}});var r=o(7437),a=o(2265),i=o(3301),n=o(641),s=o(5978),l=o(3340),c=o(7590),u=o(9115);let d=(0,a.createContext)(void 0),p=()=>{let e=(0,a.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},m=e=>{switch(e.code){case"auth/email-already-in-use":return"Este correo electr\xf3nico ya est\xe1 en uso.";case"auth/invalid-email":return"El formato del correo electr\xf3nico no es v\xe1lido.";case"auth/weak-password":return"La contrase\xf1a debe tener al menos 6 caracteres.";case"auth/user-not-found":case"auth/wrong-password":case"auth/invalid-credential":return"Correo electr\xf3nico o contrase\xf1a incorrectos.";case"auth/too-many-requests":return"Demasiados intentos. Int\xe9ntalo de nuevo m\xe1s tarde.";case"auth/popup-blocked":return"La ventana emergente de inicio de sesi\xf3n fue bloqueada por el navegador. Por favor, habilita las ventanas emergentes.";case"auth/operation-not-allowed":return"El inicio de sesi\xf3n con este m\xe9todo no est\xe1 habilitado.";case"auth/cancelled-popup-request":return"Se ha cancelado la petici\xf3n de inicio de sesi\xf3n.";case"auth/popup-closed-by-user":return"La ventana de inicio de sesi\xf3n ha sido cerrada por el usuario.";case"auth/unauthorized-domain":return"Este dominio no est\xe1 autorizado para el inicio de sesi\xf3n con Google. Por favor, a\xf1\xe1delo en la configuraci\xf3n de Firebase Authentication.";case"auth/configuration-not-found":return"La configuraci\xf3n de Firebase no es correcta. Contacta al soporte.";default:return console.error("Auth error no manejado:",e.code),"Ha ocurrido un error inesperado."}},g=e=>{let{children:t}=e,{auth:o,firestore:p}=(0,n.f2)(),[g,f]=(0,a.useState)(null),[v,h]=(0,a.useState)(!0),[S,w]=(0,a.useState)(!1),{toast:y}=(0,l.pm)(),{unlockAchievement:I}=(0,c.R)(),{isActive:A}=(0,u.N)();(0,a.useEffect)(()=>{if(!o||!p){h(!1);return}let e=(0,i.Aj)(o,async e=>{if(console.log("\uD83D\uDD35 onAuthStateChanged:",(null==e?void 0:e.email)||"No user"),f(e),e){let t=(0,s.JU)(p,"users",e.uid),o=await (0,s.QT)(t);o.exists()&&!0===o.data().premium?w(!0):w(!1)}else w(!1);h(!1)});return()=>e()},[o,p]);let D=async()=>{if(console.log("\uD83D\uDD35 Iniciando signInWithGoogle..."),!o||!p)throw Error("Firebase is not initialized");try{let e=new i.hJ;e.setCustomParameters({prompt:"select_account"}),console.log("\uD83D\uDD35 Abriendo popup de Google...");let t=await (0,i.rh)(o,e);console.log("✅ Login exitoso:",t.user.email);let r=t.user,a=(0,s.JU)(p,"users",r.uid);(await (0,s.QT)(a)).exists()?console.log("✅ Usuario ya existe en Firestore"):(console.log("\uD83D\uDD35 Creando usuario en Firestore..."),await (0,s.pl)(a,{uid:r.uid,email:r.email,displayName:r.displayName,photoURL:r.photoURL,createdAt:new Date().toISOString(),premium:!1},{merge:!0}),console.log("✅ Usuario creado en Firestore")),y({title:"\xa1Bienvenido, ".concat(r.displayName||r.email,"!"),description:"Has iniciado sesi\xf3n correctamente."})}catch(e){throw console.error("❌ Error en signInWithGoogle:",e),y({variant:"destructive",title:"Error de inicio de sesi\xf3n",description:m(e)}),e}},_=async()=>{o&&await (0,i.w7)(o)},E=async(e,t)=>{if(!o||!p)throw Error("Firebase is not initialized");let r=await (0,i.Xb)(o,e,t),a=(0,s.JU)(p,"users",r.user.uid);return(0,s.pl)(a,{uid:r.user.uid,email:r.user.email,displayName:null,photoURL:null,createdAt:new Date().toISOString(),premium:!1},{merge:!0})},b=async(e,t)=>{if(!o)throw Error("Firebase Auth is not initialized");return(0,i.e5)(o,e,t)},T=async()=>{if(A){y({title:"Modo Desarrollador Activo",description:"Las funciones Premium ya est\xe1n desbloqueadas."});return}if(!o||!p||!g)throw Error("User not authenticated or Firebase not initialized.");let e=(0,s.JU)(p,"users",g.uid);await (0,s.pl)(e,{premium:!0,fecha_pago:new Date().toISOString()},{merge:!0}),w(!0),I("premium_supporter")};return(0,r.jsx)(d.Provider,{value:{user:g,loading:v,isPremium:A||S,signInWithGoogle:D,signOut:_,signUpWithEmail:E,signInWithEmail:b,purchasePremium:T,auth:o},children:t})}},641:function(e,t,o){o.d(t,{Km:function(){return u},f2:function(){return d},CU:function(){return p}});var r=o(7437),a=o(2265),i=o(5445);class n extends i.EventEmitter{emit(e){for(var t=arguments.length,o=Array(t>1?t-1:0),r=1;r<t;r++)o[r-1]=arguments[r];return super.emit(e,...o)}on(e,t){return super.on(e,t)}off(e,t){return super.off(e,t)}}let s=new n;function l(){return(0,a.useEffect)(()=>{let e=e=>{throw e};return s.on("permission-error",e),()=>{s.off("permission-error",e)}},[]),null}let c=(0,a.createContext)(void 0);function u(e){let{children:t,value:o}=e,i=(0,a.useMemo)(()=>o,[o]);return(0,r.jsxs)(c.Provider,{value:i,children:[t,(0,r.jsx)(l,{})]})}function d(){let e=(0,a.useContext)(c);if(void 0===e)throw Error("useFirebase must be used within a FirebaseProvider");return e}function p(){return d().firestore}},7590:function(e,t,o){o.d(t,{A:function(){return s},R:function(){return l}});var r=o(7437),a=o(2265),i=o(123);let n=(0,a.createContext)(void 0),s=e=>{let{children:t}=e,o=(0,i.R)();return(0,r.jsx)(n.Provider,{value:o,children:t})},l=()=>{let e=(0,a.useContext)(n);if(void 0===e)throw Error("useAchievements must be used within an AchievementsProvider");return e}},123:function(e,t,o){o.d(t,{R:function(){return s}});var r=o(2265),a=o(6784);let i="achievements-storage",n=()=>new Date().toISOString().split("T")[0];function s(){let[e,t]=(0,r.useState)({});(0,r.useEffect)(()=>{try{let e=localStorage.getItem(i);e&&t(JSON.parse(e))}catch(e){console.error("Failed to load achievements from storage:",e)}},[]),(0,r.useEffect)(()=>{try{localStorage.setItem(i,JSON.stringify(e))}catch(e){console.error("Failed to save achievements to storage:",e)}},[e]);let o=(0,r.useCallback)(o=>{var r;let i=a.p.find(e=>e.id===o);i&&(null!==(r=e[o])&&void 0!==r&&r.unlocked||t(e=>({...e,[o]:{...e[o],unlocked:!0,progress:i.goal,unlockedAt:Date.now()}})))},[e]),s=(0,r.useCallback)((r,i)=>{var n,s;let l=a.p.find(e=>e.id===r);if(!l||(null===(n=e[r])||void 0===n?void 0:n.unlocked))return;let c=Math.max((null===(s=e[r])||void 0===s?void 0:s.progress)||0,i);t(e=>({...e,[r]:{...e[r],progress:Math.min(c,l.goal)}})),c>=l.goal&&o(r)},[e,o]),l=(0,r.useCallback)(function(r){var i,n;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=a.p.find(e=>e.id===r);if(!l||(null===(i=e[r])||void 0===i?void 0:i.unlocked))return;let c=((null===(n=e[r])||void 0===n?void 0:n.progress)||0)+s;t(e=>({...e,[r]:{...e[r],progress:Math.min(c,l.goal)}})),c>=l.goal&&o(r)},[e,o]),c=(0,r.useCallback)(()=>{o("first_use");let e=n(),t=localStorage.getItem("last-visit-date"),r=parseInt(localStorage.getItem("consecutive-days")||"0",10);if(t!==e){let o=new Date;if(o.setDate(o.getDate()-1),t===o.toISOString().split("T")[0]){let e=r+1;localStorage.setItem("consecutive-days",String(e)),s("consistency_5_days",e)}else localStorage.setItem("consecutive-days","1"),s("consistency_5_days",1);localStorage.setItem("last-visit-date",e)}},[o,s]),u=(0,r.useCallback)(()=>{let e=new Date().getHours();e<6&&o("early_bird"),e>=22&&o("night_owl");let t=n(),r="cycle-count-".concat(t),a=parseInt(localStorage.getItem(r)||"0",10)+1;localStorage.setItem(r,String(a)),l("time_master",1)},[o,l]);return{achievements:e,unlockAchievement:o,updateAchievementProgress:s,incrementAchievementProgress:l,trackAppUsage:c,trackCycleStart:u,resetAchievements:(0,r.useCallback)(()=>{t({}),localStorage.removeItem(i),localStorage.removeItem("last-visit-date"),localStorage.removeItem("consecutive-days")},[])}}},9115:function(e,t,o){o.d(t,{N:function(){return s}});var r=o(3011);let a="developer_mode_active",i="developer_mode_expiration",n=()=>{try{let e=localStorage.getItem(a),t=localStorage.getItem(i);if("true"===e&&t&&Date.now()<parseInt(t,10))return!0;return localStorage.removeItem(a),localStorage.removeItem(i),!1}catch(e){return!1}},s=(0,r.U)(e=>({isActive:n(),activateDeveloperMode:()=>{let t=Date.now()+36e5;try{localStorage.setItem(a,"true"),localStorage.setItem(i,t.toString()),e({isActive:!0}),console.log("Developer mode activated for 1 hour.")}catch(t){console.warn("localStorage is not available, developer mode will not persist."),e({isActive:!0})}}}))},3340:function(e,t,o){o.d(t,{pm:function(){return p}});var r=o(2265);let a=0,i=new Map,n=e=>{if(i.has(e))return;let t=setTimeout(()=>{i.delete(e),u({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,t)},s=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:o}=t;return o?n(o):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===o||void 0===o?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],c={toasts:[]};function u(e){c=s(c,e),l.forEach(e=>{e(c)})}function d(e){let{...t}=e,o=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>u({type:"DISMISS_TOAST",toastId:o});return u({type:"ADD_TOAST",toast:{...t,id:o,open:!0,onOpenChange:e=>{e||r()}}}),{id:o,dismiss:r,update:e=>u({type:"UPDATE_TOAST",toast:{...e,id:o}})}}function p(){let[e,t]=r.useState(c);return r.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>u({type:"DISMISS_TOAST",toastId:e})}}},6784:function(e,t,o){o.d(t,{p:function(){return f}});var r=o(6595),a=o(1928),i=o(8919),n=o(6215),s=o(7226),l=o(5621),c=o(1239),u=o(9474),d=o(7718),p=o(5954),m=o(476),g=o(1769);let f=[{id:"first_use",icon:r.Z,title:"Novato de la Carretera",description:"Usa la app por primera vez.",goal:1},{id:"premium_supporter",icon:a.Z,title:"Colaborador Premium",description:"Apoya el desarrollo comprando la versi\xf3n premium.",goal:1},{id:"sharer",icon:i.Z,title:"Embajador de la Carretera",description:"Comparte la aplicaci\xf3n con un amigo.",goal:1},{id:"early_bird",icon:n.Z,title:"Madrugador",description:"Inicia un ciclo antes de las 6 AM.",goal:1},{id:"night_owl",icon:s.Z,title:"Nocturno",description:"Inicia un ciclo despu\xe9s de las 10 PM.",goal:1},{id:"consistency_5_days",icon:l.Z,title:"Constancia",description:"Usa la app 5 d\xedas seguidos.",goal:5},{id:"speeder",icon:c.Z,title:"Velocista",description:"Alcanza los 90 km/h.",goal:90},{id:"supersonic",icon:u.Z,title:"Supers\xf3nico",description:"Alcanza los 120 km/h.",goal:120},{id:"marathoner",icon:d.Z,title:"Maratonista",description:"Acumula 100 km en un solo viaje.",goal:100},{id:"time_master",icon:p.Z,title:"Maestro del Tiempo",description:"Completa 10 ciclos en un d\xeda.",goal:10},{id:"explorer",icon:m.Z,title:"Explorador",description:"Usa el veloc\xedmetro GPS por m\xe1s de 1 hora.",goal:3600},{id:"tutorial_guru",icon:g.Z,title:"Gur\xfa del Tutorial",description:"Visita la p\xe1gina del tutorial.",goal:1}]}}]);