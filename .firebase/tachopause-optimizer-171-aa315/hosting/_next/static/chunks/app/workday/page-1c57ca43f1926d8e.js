(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3166],{7329:function(e,t,a){Promise.resolve().then(a.bind(a,8578))},9227:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("pause",[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]])},3276:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(9205).Z)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]])},8578:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return w}});var r=a(7437),n=a(2265),s=a(9820),i=a(2381),o=a(9205);let l=(0,o.Z)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var c=a(9227),d=a(3276);let u=(0,o.Z)("move-right",[["path",{d:"M18 8L22 12L18 16",key:"1r0oui"}],["path",{d:"M2 12H22",key:"1m8cig"}]]);var f=a(4438),m=a(1488),x=a(6349),v=a(9677);function h(){let{user:e}=(0,x.aC)(),[t,a]=(0,n.useState)(null),[o,h]=(0,n.useState)(!1),[p,g]=(0,n.useState)(!1),[b,j]=(0,n.useState)(0),[N,y]=(0,n.useState)(0);(0,n.useRef)(Date.now());let w=(0,n.useRef)(null),S=(0,n.useRef)(p);S.current=p,(0,n.useEffect)(()=>{if(!("geolocation"in navigator)){f.Am.error("Geolocalizaci\xf3n no soportada en tu navegador.");return}let a=!1,r=navigator.geolocation.watchPosition(r=>{let n=3.6*(r.coords.speed||0);j(n);let s=n>5;g(s),e&&t&&s!==a&&((0,v.Mt)(e.uid,t.id,s?"MOVEMENT_START":"MOVEMENT_STOP"),a=s)},e=>{e.code===e.PERMISSION_DENIED&&f.Am.error("Permiso de geolocalizaci\xf3n denegado. El contador de jornada no funcionar\xe1.")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0});return()=>navigator.geolocation.clearWatch(r)},[e,t]),(0,n.useEffect)(()=>{let a=setInterval(async()=>{e&&t&&0!==N&&(await (0,v.eA)(e.uid,t.id,{drivingTime:N}),y(0))},5e3);return()=>clearInterval(a)},[e,t,N]),(0,n.useEffect)(()=>(o?w.current=setInterval(()=>{S.current&&y(e=>e+1)},1e3):w.current&&clearInterval(w.current),()=>{w.current&&clearInterval(w.current)}),[o]);let T=async()=>{if(!e){f.Am.error("Debes iniciar sesi\xf3n para registrar tu jornada.");return}let r=!o;h(r);try{if(r){let t=await (0,v.AT)(e.uid);a(t),y(t.totalDrivingTimeSeconds||0),S.current||f.Am.info("Jornada iniciada. El contador avanzar\xe1 cuando el veh\xedculo se mueva.")}else t&&(await (0,v.Mt)(e.uid,t.id,"WORKDAY_END"),await (0,v.eA)(e.uid,t.id,{drivingTime:N}),y(0),a(null),f.Am.success("Jornada finalizada."))}catch(e){console.error("Error al cambiar el estado de la jornada:",e),f.Am.error("No se pudo actualizar el estado de la jornada."),h(!r)}};return(0,r.jsxs)(s.Zb,{className:"mb-6",children:[(0,r.jsx)(s.Ol,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(s.ll,{children:"Registro de Jornada"}),(0,r.jsxs)(m.u,{children:[(0,r.jsx)(m.aJ,{asChild:!0,children:(0,r.jsx)(i.z,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,r.jsx)(l,{className:"h-4 w-4 text-muted-foreground"})})}),(0,r.jsx)(m._v,{children:(0,r.jsx)("p",{children:"El tiempo se cuenta si la jornada est\xe1 activa y la velocidad supera los 5 km/h."})})]})]})}),(0,r.jsxs)(s.aY,{className:"flex flex-col items-center justify-center gap-4",children:[(0,r.jsx)("div",{className:"text-6xl font-bold font-mono tracking-tighter",children:function(e){let t=Math.floor(e/3600).toString().padStart(2,"0"),a=Math.floor(e%3600/60).toString().padStart(2,"0"),r=Math.floor(e%60).toString().padStart(2,"0");return"".concat(t,":").concat(a,":").concat(r)}(N)}),(0,r.jsxs)("div",{className:"flex items-center gap-6",children:[(0,r.jsxs)(i.z,{onClick:T,size:"lg",className:"w-32",disabled:!e,children:[o?(0,r.jsx)(c.Z,{className:"mr-2"}):(0,r.jsx)(d.Z,{className:"mr-2"}),o?"Finalizar":"Iniciar"]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 transition-opacity ".concat(p&&o?"opacity-100":"opacity-50"),children:[(0,r.jsx)(u,{className:"transition-transform duration-500 ".concat(p&&o?"translate-x-1":"")}),(0,r.jsxs)("span",{className:"font-medium text-lg",children:[b.toFixed(0)," km/h"]})]})]}),!e&&(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"Inicia sesi\xf3n para poder registrar tu jornada."})]})]})}var p=a(5978),g=a(3944);let b=e=>{let t={totalDriving:0,days:{}};return e.forEach(e=>{let a=new Date(e.startTime instanceof Date?e.startTime.getTime():1e3*e.startTime.seconds).toLocaleDateString("es-ES",{weekday:"long"}),r=a.charAt(0).toUpperCase()+a.slice(1);t.days[r]||(t.days[r]={startTime:e.startTime,endTime:e.endTime,totalDriving:0});let n=1e3*e.totalDrivingTimeSeconds;t.days[r].totalDriving+=n,t.totalDriving+=n}),t},j=(e,t)=>e.reduce((e,t)=>e+t.totalDrivingTimeSeconds/3600,0)+t.reduce((e,t)=>e+t.totalDrivingTimeSeconds/3600,0);var N=a(323);function y(){let{user:e}=(0,N.aC)(),[t,a]=(0,n.useState)(null);(0,n.useEffect)(()=>{if(e){let t=(0,p.ad)(),r=new Date,n=r.getDay()||7,s=new Date(r);s.setDate(r.getDate()-n+1),s.setHours(0,0,0,0),a((0,p.IO)((0,p.hJ)(t,"users/".concat(e.uid,"/workdays")),(0,p.ar)("startTime",">=",s.getTime())))}else a(null)},[e]);let{data:i,loading:o}=function(e){let[t,a]=(0,n.useState)([]),[r,s]=(0,n.useState)(!0),[i,o]=(0,n.useState)(null);return(0,n.useEffect)(()=>{if(!e){s(!1),a([]);return}s(!0);let t=(0,p.cf)(e,e=>{a(e.docs.map(e=>({id:e.id,...e.data()}))),s(!1)},e=>{console.error("Error in useCollection:",e),o(e),s(!1)});return()=>t()},[e]),{data:t,loading:r,error:i}}(t),[l,c]=(0,n.useState)(null),[d,u]=(0,n.useState)(0);(0,n.useEffect)(()=>{i&&i.length>0&&(c(b(i)),u(j(i,[])))},[i]);let f=(e,t)=>{let a=(null==t?void 0:t.totalDriving)/36e5||0,n=e.substring(0,3),s=e=>e?e.seconds?new Date(1e3*e.seconds).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"N/A";return(0,r.jsxs)("div",{className:"flex items-center justify-between py-1 text-sm border-b last:border-b-0",children:[(0,r.jsx)("span",{className:"font-medium capitalize w-12",children:n}),(0,r.jsx)("span",{className:"text-xs text-center text-muted-foreground",children:t?"".concat(s(t.startTime)," - ").concat(s(t.endTime)):"Sin registro"}),(0,r.jsxs)("span",{className:"font-semibold text-right w-16",children:[a.toFixed(1),"h"]})]},e)},m=(null==l?void 0:l.totalDriving)/36e5||0;return(0,r.jsxs)(s.Zb,{children:[(0,r.jsx)(s.Ol,{className:"py-4",children:(0,r.jsx)(s.ll,{children:"Resumen Semanal"})}),(0,r.jsx)(s.aY,{className:"pt-0 pb-4",children:o&&!i?(0,r.jsx)("p",{className:"text-center text-sm text-muted-foreground",children:"Cargando datos..."}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"space-y-1",children:["lunes","martes","mi\xe9rcoles","jueves","viernes","s\xe1bado","domingo"].map(e=>f(e,null==l?void 0:l.days[e.charAt(0).toUpperCase()+e.slice(1)]))}),(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t",children:[(0,r.jsx)("h3",{className:"font-bold mb-2 text-base",children:"Totales"}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center text-sm mb-1",children:[(0,r.jsx)("span",{children:"Semanal:"}),(0,r.jsxs)("span",{className:"".concat(m>56?"text-destructive":""),children:[m.toFixed(1),"h / ",56,"h"]})]}),(0,r.jsx)(g.E,{value:m/56*100,className:"h-2 ".concat(m>56?"[&>div]:bg-destructive":"")}),m>56&&(0,r.jsx)("p",{className:"text-xs text-destructive text-right mt-0.5",children:"L\xedmite superado"})]}),(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center text-sm mb-1",children:[(0,r.jsx)("span",{children:"Bisemanal:"}),(0,r.jsxs)("span",{className:"".concat(d>90?"text-destructive":""),children:[d.toFixed(1),"h / ",90,"h"]})]}),(0,r.jsx)(g.E,{value:d/90*100,className:"h-2 ".concat(d>90?"[&>div]:bg-destructive":"")}),d>90&&(0,r.jsx)("p",{className:"text-xs text-destructive text-right mt-0.5",children:"L\xedmite superado"})]})]})]})})]})}function w(){return(0,r.jsxs)("div",{className:"w-full max-w-md mx-auto py-6 flex flex-col gap-6",children:[(0,r.jsx)(h,{}),(0,r.jsx)(y,{})]})}},9677:function(e,t,a){"use strict";a.d(t,{AT:function(){return s},Mt:function(){return i},Tt:function(){return c},bT:function(){return n},eA:function(){return o},lu:function(){return l}}),a(3079);var r=a(2119),n=(0,r.$)("f7ca9c6a348f4946ab314160b9756adbc21e56be"),s=(0,r.$)("532e0f308f18c5302be6ae2d1083f4251b745ea9"),i=(0,r.$)("eaafc0283e2bd901bd90e938bb7a68e5806d44d8"),o=(0,r.$)("3527d2b2120a24df8a81be3cd5f440d8c41666bc"),l=(0,r.$)("400a8583cae1b772fec84c192a3eefbf320f6511"),c=(0,r.$)("5ac2d36a911a85ae45d208e2a9fb0b0cf0043b37")},2381:function(e,t,a){"use strict";a.d(t,{d:function(){return l},z:function(){return c}});var r=a(7437),n=a(2265),s=a(7053),i=a(535),o=a(3448);let l=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=n.forwardRef((e,t)=>{let{className:a,variant:n,size:i,asChild:c=!1,...d}=e,u=c?s.g7:"button";return(0,r.jsx)(u,{className:(0,o.cn)(l({variant:n,size:i,className:a})),ref:t,...d})});c.displayName="Button"},9820:function(e,t,a){"use strict";a.d(t,{Ol:function(){return o},SZ:function(){return c},Zb:function(){return i},aY:function(){return d},eW:function(){return u},ll:function(){return l}});var r=a(7437),n=a(2265),s=a(3448);let i=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...n})});i.displayName="Card";let o=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",a),...n})});o.displayName="CardHeader";let l=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("text-2xl font-semibold leading-none tracking-tight",a),...n})});l.displayName="CardTitle";let c=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("text-sm text-muted-foreground",a),...n})});c.displayName="CardDescription";let d=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("p-6 pt-0",a),...n})});d.displayName="CardContent";let u=n.forwardRef((e,t)=>{let{className:a,...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,s.cn)("flex items-center p-6 pt-0",a),...n})});u.displayName="CardFooter"},3944:function(e,t,a){"use strict";a.d(t,{E:function(){return N}});var r=a(7437),n=a(2265),s=a(3966),i=a(6840),o="Progress",[l,c]=(0,s.b)(o),[d,u]=l(o),f=n.forwardRef((e,t)=>{var a,n,s,o;let{__scopeProgress:l,value:c=null,max:u,getValueLabel:f=v,...m}=e;(u||0===u)&&!g(u)&&console.error((a="".concat(u),n="Progress","Invalid prop `max` of value `".concat(a,"` supplied to `").concat(n,"`. Only numbers greater than 0 are valid max values. Defaulting to `").concat(100,"`.")));let x=g(u)?u:100;null===c||b(c,x)||console.error((s="".concat(c),o="Progress","Invalid prop `value` of value `".concat(s,"` supplied to `").concat(o,"`. The `value` prop must be:\n  - a positive number\n  - less than the value passed to `max` (or ").concat(100," if no `max` prop is set)\n  - `null` or `undefined` if the progress is indeterminate.\n\nDefaulting to `null`.")));let j=b(c,x)?c:null,N=p(j)?f(j,x):void 0;return(0,r.jsx)(d,{scope:l,value:j,max:x,children:(0,r.jsx)(i.WV.div,{"aria-valuemax":x,"aria-valuemin":0,"aria-valuenow":p(j)?j:void 0,"aria-valuetext":N,role:"progressbar","data-state":h(j,x),"data-value":null!=j?j:void 0,"data-max":x,...m,ref:t})})});f.displayName=o;var m="ProgressIndicator",x=n.forwardRef((e,t)=>{var a;let{__scopeProgress:n,...s}=e,o=u(m,n);return(0,r.jsx)(i.WV.div,{"data-state":h(o.value,o.max),"data-value":null!==(a=o.value)&&void 0!==a?a:void 0,"data-max":o.max,...s,ref:t})});function v(e,t){return"".concat(Math.round(e/t*100),"%")}function h(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function p(e){return"number"==typeof e}function g(e){return p(e)&&!isNaN(e)&&e>0}function b(e,t){return p(e)&&!isNaN(e)&&e<=t&&e>=0}x.displayName=m;var j=a(3448);let N=n.forwardRef((e,t)=>{let{className:a,value:n,...s}=e;return(0,r.jsx)(f,{ref:t,className:(0,j.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",a),...s,children:(0,r.jsx)(x,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(n||0),"%)")}})})});N.displayName=f.displayName},1488:function(e,t,a){"use strict";a.d(t,{_v:function(){return d},aJ:function(){return c},pn:function(){return o},u:function(){return l}});var r=a(7437),n=a(2265),s=a(1312),i=a(3448);let o=s.zt,l=s.fC,c=s.xz,d=n.forwardRef((e,t)=>{let{className:a,sideOffset:n=4,...o}=e;return(0,r.jsx)(s.VY,{ref:t,sideOffset:n,className:(0,i.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...o})});d.displayName=s.VY.displayName},323:function(e,t,a){"use strict";a.d(t,{CU:function(){return r.CU},Km:function(){return r.Km},T3:function(){return n.T3},aC:function(){return n.aC}}),a(738),a(3301),a(5978);var r=a(641),n=a(6349);a(257)},3448:function(e,t,a){"use strict";a.d(t,{cn:function(){return s}});var r=a(1994),n=a(3335);function s(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,n.m6)((0,r.W)(t))}}},function(e){e.O(0,[4358,139,9555,6137,611,2661,8782,1312,6349,2971,2117,1744],function(){return e(e.s=7329)}),_N_E=e.O()}]);